<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>è®¢å•æŸ¥è¯¢ - äº¬ä¸œè®¢å•ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            padding: 60px 40px;
            text-align: center;
        }

        .header h1 {
            color: #333;
            font-size: 36px;
            margin-bottom: 40px;
            font-weight: 500;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 24px;
                margin-bottom: 20px;
            }
        }

        .search-box {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            gap: 10px;
            margin-bottom: 60px;
        }

        .search-box input {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .search-box {
                flex-direction: column;
                margin-bottom: 30px;
            }

            .search-box input {
                padding: 12px 16px;
                font-size: 14px;
            }
        }

        .search-box input:focus {
            outline: none;
            box-shadow: 0 2px 15px rgba(0,0,0,0.15);
        }

        .search-btn {
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            background: white;
            color: #666;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .search-btn {
                padding: 12px 30px;
                font-size: 14px;
            }
        }

        .search-btn:hover {
            background: #f5f5f5;
            box-shadow: 0 2px 15px rgba(0,0,0,0.15);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .notice-panel {
            background: white;
            max-width: 900px;
            margin: 0 auto 40px;
            padding: 40px;
            border: 2px dashed #ddd;
            border-radius: 10px;
        }

        .notice-panel h2 {
            color: #333;
            font-size: 24px;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 500;
        }

        .notice-list {
            color: #666;
            font-size: 15px;
            line-height: 2;
        }

        .notice-list li {
            margin-bottom: 15px;
            padding-left: 10px;
        }

        @media (max-width: 768px) {
            .notice-panel {
                padding: 20px;
                margin: 0 10px 20px;
            }

            .notice-panel h2 {
                font-size: 18px;
                margin-bottom: 20px;
            }

            .notice-list {
                font-size: 13px;
                line-height: 1.8;
            }

            .notice-list li {
                margin-bottom: 10px;
            }
        }

        .result-panel {
            background: white;
            max-width: 900px;
            margin: 40px auto;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }

        @media (max-width: 768px) {
            .result-panel {
                margin: 20px 10px;
                padding: 20px;
            }
        }

        .order-info {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .order-info:last-child {
            border-bottom: none;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .order-id {
            color: #333;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .order-header {
                flex-direction: column;
                gap: 10px;
            }

            .order-id {
                font-size: 14px;
                word-break: break-all;
            }
        }

        .order-status {
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 14px;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .order-details {
            color: #666;
            font-size: 14px;
            line-height: 1.8;
        }

        .order-details div {
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .order-details {
                font-size: 13px;
            }
        }

        .no-result {
            text-align: center;
            color: #999;
            padding: 40px;
            display: none;
            background: white;
            max-width: 900px;
            margin: 40px auto;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .no-result {
                margin: 20px 10px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>æœç´¢è®¢å•ï¼ŒæŸ¥è¯¢çŠ¶æ€</h1>
        <div style="text-align: right; margin-bottom: 20px;">
            <a href="summary.html" style="color: #333; text-decoration: none; padding: 8px 15px; background: white; border-radius: 20px; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">ğŸ“‹ è®¢å•åˆ—è¡¨</a>
        </div>
        <div class="search-box">
            <input type="text" id="orderId" placeholder="è¯·è¾“å…¥è®¢å•å·" onkeypress="if(event.keyCode==13) searchOrder()">
            <button class="search-btn" onclick="searchOrder()">æŸ¥è¯¢</button>
        </div>
    </div>

    <div class="container">
        <div id="resultPanel" class="result-panel">
            <div id="orderList"></div>
        </div>

        <div id="noResult" class="no-result">
            <p>æœªæŸ¥è¯¢åˆ°ç›¸å…³è®¢å•ä¿¡æ¯</p>
        </div>

        <div class="notice-panel">
            <h2>è®¢å•æŸ¥è¯¢é¡»çŸ¥</h2>
            <ol class="notice-list">
                <li>æŸ¥å•ç³»ç»Ÿæœ‰å»¶æ—¶ï¼Œè¯·ä¸‹å•3åˆ†é’Ÿåå†æŸ¥ï¼Œæ˜¾ç¤ºä¸‹å•ä¿¡æ¯å³ä¸ºã€è·Ÿå›¢æˆåŠŸã€‘ï¼Œä¸‹å•3ï½10åˆ†é’Ÿå‡ºç°ç»“ç®—ä½£é‡‘ä¸º"æš‚æ— ç›¸å…³è®¢å•"å³ã€è·Ÿå›¢å¤±è´¥ã€‘ï¼Œè¯·å°½å¿«é‡æ–°ä¸‹å•ã€‚</li>
                <li>å¹»è±¡å›¢è·Ÿå›¢æˆåŠŸäº§å“äº«å—ã€30å¤©æ— ç†ç”±é€€è´§æ—¥é€€è´§åŒ…è¿è´¹ã€‘ä¼˜è´¨æœåŠ¡ï¼ˆæ‰‹æœºé™¤å¤–ï¼Œ30å¤©é€€è´§è”ç³»å¹»è±¡å›¢å®¢æœï¼‰</li>
                <li>äº¬ä¸œå¾…ä»˜æ¬¾è®¢å•å³å¯æŸ¥è¯¢ï¼Œæ·˜å®å·²ä»˜æ¬¾è®¢å•æ‰èƒ½æŸ¥è¯¢ï¼ˆå¾…ä»˜æ¬¾è®¢å•ä¸èƒ½æŸ¥ï¼‰</li>
                <li>äº¬ä¸œå¯èƒ½å­˜åœ¨æ‹†å•æ›´æ–°è®¢å•å·çš„æƒ…å†µï¼Œä»˜æ¬¾åè¯·ç”¨äº¬ä¸œæœ€æ–°è®¢å•å·è¿›è¡ŒæŸ¥è¯¢ã€‚</li>
                <li>ä¸‹å•ä¸å¯ä½¿ç”¨è¶…çº§çº¢åŒ…ï¼Œäº¬äº«ç¤¼é‡‘ï¼Œäº¬ä¸œeå¡ï¼Œä»¥åŠä»»ä½•è¿”åˆ©è½¯ä»¶ï¼Œä¼šå¯¼è‡´è®¢å•è·Ÿå›¢å¤±è´¥ï¼Œæ— æ³•äº«å—å›¢è´­è¿è´¹ä»¥åŠå”®åæ”¿ç­–ã€‚</li>
                <li>å¦‚æŸ¥è¯¢ç»“æœæ˜¾ç¤ºã€æµé‡å¼‚å¸¸&è¿è§„è®¢å•ã€‘ç­‰ç‰¹æ®Šæƒ…å†µï¼›æœªå‘è´§è®¢å•è¯·é‡æ–°ä¸‹å•ï¼Œå·²å‘è´§è®¢å•è”ç³»å¹»è±¡å›¢å®¢æœåç»­å¤„ç†</li>
                <li>å¦‚æœ‰å…¶ä»–ç–‘é—®ï¼Œè¯·ä¼˜å…ˆå’¨è¯¢å¼€å›¢ç¾¤å†…å®¢æœæˆ–è€…åœ¨å¾®ä¿¡å°ç¨‹åº-ã€å¹»è±¡å›¢ã€‘-ã€æˆ‘çš„ã€‘è”ç³»å”®åå®¢æœã€‚</li>
            </ol>
        </div>
    </div>

    <script>
        // æŸ¥è¯¢è®¢å•
        async function searchOrder() {
            const orderId = document.getElementById('orderId').value.trim();
            
            if (!orderId) {
                alert('è¯·è¾“å…¥è®¢å•å·');
                return;
            }

            console.log('æŸ¥è¯¢è®¢å•å·:', orderId);

            try {
                const url = `/api/orders?orderId=${orderId}`;
                console.log('è¯·æ±‚URL:', url);
                const response = await fetch(url);
                console.log('å“åº”çŠ¶æ€:', response.status);
                const result = await response.json();
                console.log('å“åº”æ•°æ®:', result);

                const resultPanel = document.getElementById('resultPanel');
                const orderList = document.getElementById('orderList');
                const noResult = document.getElementById('noResult');

                if (result.success && result.data && result.data.data.length > 0) {
                    // æœ‰æ•ˆçŠ¶æ€ç ï¼š15-å¾…ä»˜æ¬¾, 16-å·²ä»˜æ¬¾, 17-å·²å®Œæˆ, 24-å·²ä»˜å®šé‡‘, 33-è¶…å¸‚å¡å……å€¼
                    const validCodes = [15, 16, 17, 24, 33];
                    const order = result.data.data[0];
                    
                    // æ£€æŸ¥validCodeæ˜¯å¦ä¸ºæœ‰æ•ˆçŠ¶æ€
                    if (!validCodes.includes(order.valid_code)) {
                        // æ— æ•ˆçŠ¶æ€ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
                        alert('æ­¤è®¢å•æ— æ³•è·å–è·Ÿå›¢æƒç›Šï¼Œæ‚¨è®¢å•å·ä¸­ä½¿ç”¨äº†äº¬è±†ï¼Œè¿”åˆ©ï¼Œå°çº¢åŒ…ç­‰æƒ…å†µï¼Œè¯·æ³¨æ„æ£€æŸ¥ï¼Œæˆ–è”ç³»ç¾¤å†…å®¢æˆ·');
                        resultPanel.style.display = 'none';
                        noResult.style.display = 'none';
                        return;
                    }

                    // æ˜¾ç¤ºè®¢å•ä¿¡æ¯
                    orderList.innerHTML = '';
                    result.data.data.forEach(order => {
                        const statusMap = {
                            15: { text: 'å¾…ä»˜æ¬¾', class: 'status-pending' },
                            16: { text: 'å·²ä»˜æ¬¾', class: 'status-success' },
                            17: { text: 'å·²å®Œæˆ', class: 'status-success' },
                            24: { text: 'å·²ä»˜å®šé‡‘', class: 'status-pending' },
                            33: { text: 'è¶…å¸‚å¡å……å€¼', class: 'status-success' }
                        };
                        const status = statusMap[order.valid_code] || { text: 'æœªçŸ¥', class: 'status-pending' };

                        // å¤„ç†ä¸‹å•æ—¶é—´ï¼Œåªæ˜¾ç¤ºå¹´æœˆæ—¥
                        let orderTime = order.order_time || '-';
                        if (orderTime !== '-') {
                            try {
                                // å°è¯•è§£ææ—¶é—´
                                const date = new Date(orderTime);
                                if (!isNaN(date.getTime())) {
                                    // æ ¼å¼åŒ–ä¸º YYYY-MM-DD
                                    const year = date.getFullYear();
                                    const month = String(date.getMonth() + 1).padStart(2, '0');
                                    const day = String(date.getDate()).padStart(2, '0');
                                    orderTime = `${year}-${month}-${day}`;
                                }
                            } catch (e) {
                                // å¦‚æœè§£æå¤±è´¥ï¼Œå°è¯•æˆªå–å‰10ä½
                                if (orderTime.length > 10 && orderTime.includes('-')) {
                                    orderTime = orderTime.substring(0, 10);
                                }
                            }
                        }

                        const orderHtml = `
                            <div class="order-info">
                                <div class="order-header">
                                    <span class="order-id">è®¢å•å·ï¼š${order.order_id}</span>
                                    <span class="order-status ${status.class}">${status.text}</span>
                                </div>
                                <div class="order-details">
                                    <div><strong>å•†å“åç§°ï¼š</strong>${order.sku_name || '-'}</div>
                                    <div><strong>ä¸‹å•æ—¶é—´ï¼š</strong>${orderTime}</div>
                                    <div><strong>å•†å“æ•°é‡ï¼š</strong>${order.sku_num || 0} ä»¶</div>
                                    <div><strong>å•†å“å•ä»·ï¼š</strong>Â¥${parseFloat(order.price || 0).toFixed(2)}</div>
                                    <div><strong>åº—é“ºåç§°ï¼š</strong>${order.shop_name || '-'}</div>
                                </div>
                            </div>
                        `;
                        orderList.innerHTML += orderHtml;
                    });
                    resultPanel.style.display = 'block';
                    noResult.style.display = 'none';
                } else {
                    // æœªæŸ¥è¯¢åˆ°è®¢å•ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
                    alert('æ­¤è®¢å•æ— æ³•è·å–è·Ÿå›¢æƒç›Šï¼Œæ‚¨è®¢å•å·ä¸­ä½¿ç”¨äº†äº¬è±†ï¼Œè¿”åˆ©ï¼Œå°çº¢åŒ…ç­‰æƒ…å†µï¼Œè¯·æ³¨æ„æ£€æŸ¥ï¼Œæˆ–è”ç³»ç¾¤å†…å®¢æˆ·');
                    resultPanel.style.display = 'none';
                    noResult.style.display = 'none';
                }
            } catch (error) {
                console.error('æŸ¥è¯¢å¤±è´¥:', error);
                alert('æŸ¥è¯¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
    </script>
</body>
</html>
